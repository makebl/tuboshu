import{_ as N,o as b,c as O,b as e,a as n,t as E,r as h,w as F,q as J,d as s,e as g,u as I,n as Q,f as M,N as z,g as W,j as R,p as U,k as K,l as X,m as Y,F as D,s as Z}from"./index-B4nQfrb3.js";import{_ as V}from"./Avatar-oEGPg4yV.js";import{d as j}from"./vuedraggable.umd-D97wmwN7.js";import{u as A,_ as ee,a as te}from"./Switch-4WFdEShy.js";import{i as se,a as oe,_ as L,b as ne,c as ae,d as ce}from"./addNew-DjIEq2SQ.js";import{_ as q,N as le}from"./headers-8IAN-_pw.js";import"./Tag-C4y78EQc.js";const ie={class:"wrap-box"},_e={class:"name"},re={__name:"GroupIcon",props:{element:Object},setup(a){return(w,p)=>{const i=V;return b(),O("div",ie,[e(i,{round:"",size:"10",src:a.element.img},null,8,["src"]),n("span",_e,E(a.element.tag),1)])}}},H=N(re,[["__scopeId","data-v-d1fd4127"]]),ue={},pe={t:"1744351194115",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"8334",width:"128",height:"128"},de=n("path",{d:"M65.290005 512c0 51.938929 42.104957 94.04491 94.04491 94.04491s94.04491-42.104957 94.044909-94.04491-42.104957-94.04491-94.044909-94.04491-94.04491 42.104957-94.04491 94.04491zM417.95509 512c0 51.938929 42.104957 94.04491 94.04491 94.04491 51.938929 0 94.04491-42.104957 94.04491-94.04491s-42.104957-94.04491-94.04491-94.04491c-51.939953 0-94.04491 42.104957-94.04491 94.04491zM770.620176 512c0 51.938929 42.104957 94.04491 94.044909 94.04491s94.04491-42.104957 94.04491-94.04491-42.104957-94.04491-94.04491-94.04491-94.04491 42.104957-94.044909 94.04491z",fill:"","p-id":"8335"},null,-1),me=[de];function ve(a,w){return b(),O("svg",pe,me)}const he=N(ue,[["render",ve]]),fe={class:"wrapper"},ge={class:"title"},we={class:"tag_name"},ye={class:"operate"},be={class:"switch"},xe={class:"box"},$e={__name:"GroupItem",props:{element:Object,list:Array},emits:["edit","remove","change"],setup(a,{emit:w}){const p=A(),i=w,c=a,m=h([]),f=h(!1),r=h(!1),y=[{label:"修改",key:"modify"},{label:"删除",key:"remove"}],k=(t,o)=>{m.value=[];const _=new Map;t.forEach(d=>{_.set(d.name,d)}),m.value=o.map(d=>_.get(d)).filter(Boolean)};F(()=>c.element,t=>{const o=t.sites.split(",");k(c.list,o),r.value=t.isOpen},{immediate:!0}),J(()=>{r.value=c.element.isOpen;const t=c.element.sites.split(",");k(c.list,t)});const G=t=>{i(t==="modify"?"edit":"remove",c.element)},v=()=>{f.value=!f.value},x=async t=>{const o=Object.assign(M(c.element),{isOpen:t});await window.myApi.updateGroup(o),i("change"),p.success("操作成功")},l=async t=>{try{const o=m.value.map(_=>_.name).join(",");await window.myApi.updateGroup(Object.assign(M(c.element),{sites:o})),p.success("保存成功")}catch(o){p.error("保存失败"+o)}};return(t,o)=>{const _=z,d=W,u=ee,$=H;return b(),O("div",fe,[n("div",ge,[n("div",we,E(a.element.tag),1),n("div",ye,[e(d,{trigger:"click",options:y,onSelect:G},{default:s(()=>[n("span",{onClick:v},[e(_,{size:"20"},{default:s(()=>[e(he)]),_:1})])]),_:1})]),n("div",be,[e(u,{size:"small",value:I(r),"onUpdate:value":[o[0]||(o[0]=C=>Q(r)?r.value=C:null),x],style:{"font-size":"10px"}},{checked:s(()=>[g("启用")]),unchecked:s(()=>[g("关闭")]),_:1},8,["value"])])]),n("div",xe,[e(I(j),{class:"list-group",list:I(m),group:a.element.name,onChange:l,itemKey:"name"},{item:s(({element:C,index:B})=>[e($,{element:C},null,8,["element"])]),_:1},8,["list","group"])])])}}},Se=N($e,[["__scopeId","data-v-edb5dada"]]),T=a=>(U("data-v-ce782d2a"),a=a(),K(),a),Oe={class:"flex-row"},ke={class:"box"},Ge={class:"box"},Ce=T(()=>n("br",null,null,-1)),Ie=T(()=>n("p",{style:{color:"#888"}},[g(" 可拖动添加或者删除分组内的站点"),n("br"),g(" 分组内的站点也可以拖动排序"),n("br")],-1)),Ne={class:"flex-footer"},Me={__name:"GroupDrawer",props:{element:Object,show:Boolean,list:Array},emits:["update:show","saveForm"],setup(a,{emit:w}){const p=A(),i=w,c=a,m=h("新增分组"),f=h([]),r=h([]),y=h(""),k=(l,t)=>{f.value=[],r.value=[];const o=t.sites.split(",").filter(Boolean),_=new Map;l.forEach(u=>{_.set(u.name,u)}),r.value=o.map(u=>_.get(u)).filter(Boolean);const d=new Set(o);f.value=l.filter(u=>!d.has(u.name))};F(()=>c.element,l=>{k(JSON.parse(JSON.stringify(c.list)),l),y.value=l.tag,m.value=l!=null&&l.name?"编辑站点":"新增分组"},{immediate:!0});const G=()=>{i("update:show",!1)},v=async()=>{if(!y.value)return p.error("分组名称不能为空");try{const l=r.value.map(o=>o.name),t={tag:y.value,sites:l.join(",")};await window.myApi.updateGroup(Object.assign(M(c.element),t)),p.success("保存成功"),i("saveForm",t),i("update:show",!1)}catch(l){p.error("保存失败"+l)}},x=l=>{console.log("sites.value",r.value)};return(l,t)=>{const o=te,_=H,d=q,u=z,$=L,C=ne,B=ae;return b(),R(B,{show:a.show,"onUpdate:show":t[1]||(t[1]=S=>i("update:show",S)),width:502,placement:"right"},{default:s(()=>[e(C,{title:m.value,closable:""},{footer:s(()=>[n("div",Ne,[e($,{color:"#888",onClick:G},{icon:s(()=>[e(u,{color:"#fff"},{default:s(()=>[e(se)]),_:1})]),default:s(()=>[g(" 取消 ")]),_:1}),e($,{color:"#2080f0",onClick:v},{icon:s(()=>[e(u,{color:"#fff"},{default:s(()=>[e(oe)]),_:1})]),default:s(()=>[g(" 保存 ")]),_:1})])]),default:s(()=>[n("div",Oe,[e(o,{type:"text",size:"large",placeholder:"分组名称",value:y.value,"onUpdate:value":t[0]||(t[0]=S=>y.value=S),clearable:""},null,8,["value"])]),n("div",ke,[e(I(j),{class:"list-group",list:r.value,group:"site",onChange:x,itemKey:"name"},{item:s(({element:S,index:P})=>[e(_,{element:S},null,8,["element"])]),_:1},8,["list"])]),n("div",Ge,[e(I(j),{class:"list-group list-all",list:f.value,group:"site",itemKey:"name"},{item:s(({element:S,index:P})=>[e(_,{element:S},null,8,["element"])]),_:1},8,["list"])]),Ce,e(d,{"show-icon":!1},{default:s(()=>[Ie]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}},je=N(Me,[["__scopeId","data-v-ce782d2a"]]),ze=a=>(U("data-v-0b81e53d"),a=a(),K(),a),Ae={id:"content-main"},Be=ze(()=>n("br",null,null,-1)),De={class:"box"},Ee={class:"box-title"},Fe={class:"box-card"},Je={class:"wrap"},Re={key:1,style:{color:"#888","font-size":"14px"}},Ue={__name:"GroupView",setup(a){const w=A(),p=h([]),i=h([]),c=h(!1),m=h({tag:"",sites:"",isOpen:!1}),f=async()=>{try{p.value=(await window.myApi.getConfig()).openMenus,i.value=await window.myApi.getGroups()}catch(v){w.error("读取配置文件失败"+v)}};J(async()=>{await f()});const r=()=>{m.value={tag:"",sites:"",isOpen:!1},c.value=!0},y=v=>{m.value=JSON.parse(JSON.stringify(v)),c.value=!0},k=async v=>{try{await window.myApi.removeGroup(M(v)),w.success("删除成功")}catch(x){w.error("删除失败"+x)}await f()},G=async v=>{await f()};return(v,x)=>{const l=le,t=q,o=z,_=L,d=Se,u=X("auto-height");return b(),O(D,null,[n("div",Ae,[e(t,{"show-icon":!1,type:"info",style:{"margin-bottom":"1rem"}},{default:s(()=>[e(l,{style:{"margin-bottom":"0"}},{default:s(()=>[g("站点分组")]),_:1})]),_:1}),e(t,{"show-icon":!1},{default:s(()=>[g(" 1.没有创建或启用分组时，默认为全部站点;"),Be,g(" 2.拖动站点图标可排序； ")]),_:1}),n("div",De,[n("div",Ee,[e(_,{color:"#2080f0",onClick:r},{icon:s(()=>[e(o,{color:"#fff"},{default:s(()=>[e(ce)]),_:1})]),default:s(()=>[g(" 添加分组 ")]),_:1})]),Y((b(),O("div",Fe,[n("div",Je,[i.value&&i.value.length>0?(b(!0),O(D,{key:0},Z(i.value,$=>(b(),R(d,{element:$,list:p.value,onEdit:y,onRemove:k,onChange:G},null,8,["element","list"]))),256)):(b(),O("div",Re,"没有分组数据"))])])),[[u,{offset:20}]])])]),e(je,{show:c.value,"onUpdate:show":x[0]||(x[0]=$=>c.value=$),element:m.value,list:p.value,onSaveForm:G},null,8,["show","element","list"])],64)}}},We=N(Ue,[["__scopeId","data-v-0b81e53d"]]);export{We as default};
